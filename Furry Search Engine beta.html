<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Furry Search Engine beta</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #165DFF;
            --bg: #ffffff;
            --surface: #ffffff;
            --text: #1D2129;
            --text-secondary: #4E5969;
            --border: #E5E6EB;
            --shadow: 0 1px 6px rgba(169,172,175,0.28);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --bg-opacity: 1;
            --default-bg-color: #F5F7FA;
            --logo-main: #165DFF;
            --logo-sub: #1D2129;
        }
        .dark-theme {
            --primary: #4080FF;
            --bg: #141414;
            --surface: #1F1F1F;
            --text: #F7F8FA;
            --text-secondary: #86909C;
            --border: #303030;
            --shadow: 0 1px 6px rgba(0,0,0,0.5);
            --bg-opacity: 0.5;
            --default-bg-color: #0F172A;
            --logo-main: #4080FF;
            --logo-sub: #F7F8FA;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI Variable', 'Segoe UI', Roboto, 'Helvetica Neue', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            font-weight: 400;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
            transition: var(--transition);
            line-height: 1.5;
        }
        .bg-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }
        .dynamic-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--default-bg-color);
            opacity: var(--bg-opacity);
            transition: opacity 1s ease;
            z-index: -2;
        }
        .custom-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0;
            transition: opacity 1s ease;
            z-index: -1;
        }
        .custom-video-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0;
            transition: opacity 1s ease;
            z-index: -1;
        }
        .custom-bg.active, .custom-video-bg.active {
            opacity: var(--bg-opacity);
        }
        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
            transition: var(--transition);
            opacity: 0;
        }
        .logo {
            font-size: 3.5rem;
            font-weight: 400;
            margin-bottom: 40px;
            animation: fadeInUp 0.8s ease-out;
            letter-spacing: -0.02em;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px;
        }
        .logo .furry {
            color: var(--logo-main);
            font-weight: 500;
        }
        .logo .search-engine {
            color: var(--logo-sub);
        }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .search-group {
            width: 100%;
            max-width: 600px;
            position: relative;
            margin-bottom: 30px;
            animation: fadeInUp 0.8s ease-out 0.2s forwards;
            opacity: 0;
            z-index: 200;
        }
        .search-box {
            width: 100%;
            padding: 16px 24px;
            font-size: 16px;
            font-weight: 400;
            border: 1px solid var(--border);
            border-radius: 24px;
            background: var(--surface);
            color: var(--text);
            box-shadow: var(--shadow);
            transition: var(--transition);
            outline: none;
        }
        .search-box:focus {
            box-shadow: 0 1px 12px rgba(22,93,255,0.25);
            border-color: var(--primary);
        }
        .search-btn {
            position: absolute;
            right: 8px;
            top: 8px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 16px;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .search-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(22,93,255,0.3);
        }
        .suggestions-container {
            width: 100%;
            max-width: 600px;
            margin: 0 auto 20px auto;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s cubic-bezier(0.25, 1, 0.5, 1), 
                        margin-bottom 0.4s cubic-bezier(0.25, 1, 0.5, 1),
                        opacity 0.3s ease;
            opacity: 0;
            z-index: 150;
        }
        .suggestions-container.active {
            max-height: 300px;
            margin-bottom: 20px;
            opacity: 1;
        }
        .suggestions {
            width: 100%;
            background: var(--surface);
            border-radius: 24px;
            box-shadow: var(--shadow);
            max-height: 300px;
            overflow-y: auto;
            padding: 8px 0;
            transform-origin: top center;
            transform: scaleY(0.95);
            transition: transform 0.3s cubic-bezier(0.25, 1, 0.5, 1),
                        box-shadow 0.3s ease;
        }
        .suggestions-container.active .suggestions {
            transform: scaleY(1);
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .suggestion-item {
            padding: 12px 24px;
            font-weight: 400;
            cursor: pointer;
            transition: all 0.2s ease;
            transform: translateX(-10px);
            opacity: 0;
            animation: slideIn 0.3s ease forwards;
        }
        .suggestion-item:nth-child(1) { animation-delay: 0.05s; }
        .suggestion-item:nth-child(2) { animation-delay: 0.1s; }
        .suggestion-item:nth-child(3) { animation-delay: 0.15s; }
        .suggestion-item:nth-child(4) { animation-delay: 0.2s; }
        .suggestion-item:nth-child(5) { animation-delay: 0.25s; }
        .suggestion-item:nth-child(6) { animation-delay: 0.3s; }
        .suggestion-item:nth-child(7) { animation-delay: 0.35s; }
        .suggestion-item:nth-child(8) { animation-delay: 0.4s; }
        .suggestion-item:nth-child(9) { animation-delay: 0.45s; }
        .suggestion-item:nth-child(10) { animation-delay: 0.5s; }
        @keyframes slideIn {
            from { transform: translateX(-10px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .suggestion-item:hover {
            background: rgba(22,93,255,0.05);
            border-radius: 12px;
            margin: 0 8px;
            transform: translateX(4px);
            box-shadow: 0 2px 8px rgba(22,93,255,0.1);
        }
        .dark-theme .suggestion-item:hover {
            background: rgba(64,128,255,0.08);
            box-shadow: 0 2px 8px rgba(64,128,255,0.1);
        }
        .suggestions::-webkit-scrollbar { width: 6px; }
        .suggestions::-webkit-scrollbar-track { background: transparent; border-radius: 10px; }
        .suggestions::-webkit-scrollbar-thumb { background: var(--border); border-radius: 10px; transition: background 0.2s ease; }
        .suggestions::-webkit-scrollbar-thumb:hover { background: var(--primary); }
        .quick-links {
            display: flex;
            gap: 16px;
            margin-bottom: 40px;
            animation: fadeInUp 0.8s ease-out 0.4s forwards;
            opacity: 0;
            position: relative;
            z-index: 100;
            background: var(--surface);
            padding: 10px;
            border-radius: 8px;
            transition: var(--transition);
            flex-wrap: wrap;
            justify-content: center;
        }
        .quick-link {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 18px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 20px;
            color: var(--text);
            text-decoration: none;
            font-size: 14px;
            font-weight: 400;
            transition: var(--transition);
        }
        .quick-link:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }
        .footer {
            position: absolute;
            bottom: 20px;
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 400;
            animation: fadeInUp 0.8s ease-out 0.6s forwards;
            opacity: 0;
        }
        .action-btn {
            position: fixed;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: var(--surface);
            border: 1px solid var(--border);
            color: var(--text);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: 400;
            transition: var(--transition);
            z-index: 1000;
            pointer-events: auto;
        }
        .action-btn:hover { transform: scale(1.1); box-shadow: var(--shadow); }
        .theme-toggle { top: 20px; left: 20px; }
        .settings-btn { top: 20px; right: 20px; }
        .settings-panel {
            position: fixed;
            top: 0;
            right: -400px;
            width: 380px;
            height: 100%;
            background: var(--surface);
            box-shadow: -2px 0 20px rgba(0,0,0,0.2);
            z-index: 1001;
            padding: 30px;
            transition: right 0.5s cubic-bezier(0.34,1.56,0.64,1);
            overflow-y: auto;
        }
        .settings-panel.active { right: 0; }
        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }
        .settings-title { font-size: 24px; font-weight: 500; }
        .close-settings {
            background: none;
            border: none;
            font-size: 24px;
            color: var(--text);
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        .close-settings:hover { transform: scale(1.2); }
        .setting-item {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border);
        }
        .setting-title {
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .toggle-switch { position: relative; display: inline-block; width: 52px; height: 26px; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background: #ccc; transition: .4s; border-radius: 34px;
        }
        .toggle-slider:before {
            position: absolute; content: "";
            height: 18px; width: 18px; left: 4px; bottom: 4px;
            background: white; transition: .4s; border-radius: 50%;
        }
        input:checked + .toggle-slider { background: var(--primary); }
        input:checked + .toggle-slider:before { transform: translateX(26px); }
        .upload-btn {
            display: inline-block;
            padding: 10px 20px;
            background: var(--primary);
            color: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: var(--transition);
            border: none;
            margin-top: 10px;
            margin-right: 10px;
        }
        .upload-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(22,93,255,0.3);
        }
        .save-video-btn {
            background: #52c41a !important;
        }
        .save-video-btn:hover {
            box-shadow: 0 4px 12px rgba(82, 196, 26, 0.3) !important;
        }
        .clear-cache-btn {
            background: #86909C;
            margin-top: 10px;
        }
        .clear-cache-btn:hover {
            background: #ff4d4f;
            box-shadow: 0 4px 12px rgba(255,77,79,0.3);
        }
        #bgUpload, #videoUpload { display: none; }
        .bg-type-selector {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }
        .bg-type-btn {
            padding: 8px 16px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text);
            cursor: pointer;
            transition: var(--transition);
            font-size: 14px;
            font-weight: 400;
        }
        .bg-type-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        .tip-text {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 8px;
            line-height: 1.4;
        }
        .error-tip {
            color: #ff4d4f;
            font-size: 12px;
            margin-top: 8px;
        }
        .success-tip {
            color: #52c41a;
            font-size: 12px;
            margin-top: 8px;
        }
        @media (max-width: 768px) {
            .logo { font-size: 2.5rem; flex-direction: column; text-align: center; gap: 4px; }
            .settings-panel { width: 100%; right: -100%; }
            .quick-links { flex-direction: column; align-items: center; }
            .bg-type-selector { flex-direction: column; }
            .upload-btn { margin-right: 0; margin-bottom: 10px; width: 100%; }
            .clear-cache-btn { width: 100%; margin-right: 0; }
            .suggestions-container { width: 90%; }
            .action-btn { width: 44px; height: 44px; font-size: 18px; }
        }
    </style>
</head>
<body>
    <div class="bg-container">
        <div class="dynamic-bg" id="dynamicBg"></div>
        <img class="custom-bg" id="customBg" alt="Custom Background">
        <video class="custom-video-bg" id="customVideoBg" autoplay loop muted playsinline></video>
    </div>
    <button class="action-btn theme-toggle" id="themeToggle">
        <i class="fas fa-moon" id="themeIcon"></i>
    </button>
    <button class="action-btn settings-btn" id="settingsBtn">
        <i class="fas fa-cog"></i>
    </button>
    <div class="container" id="mainContainer">
        <h1 class="logo">
            <span class="furry">Furry</span>
            <span class="search-engine">Search Engine</span>
        </h1>
        <div class="search-group" id="searchGroup">
            <input type="text" class="search-box" id="searchBox" placeholder="Search the web..." autocomplete="off">
            <button class="search-btn" id="searchBtn">
                <i class="fas fa-search"></i> Search
            </button>
        </div>
        <div class="suggestions-container" id="suggestionsContainer">
            <div class="suggestions" id="suggestionsBox"></div>
        </div>
        <div class="quick-links">
            <a href="https://github.com" target="_blank" class="quick-link"><i class="fab fa-github"></i> Github</a>
            <a href="https://tiktok.com" target="_blank" class="quick-link"><i class="fab fa-tiktok"></i> Tiktok</a>
            <a href="https://youtube.com" target="_blank" class="quick-link"><i class="fab fa-youtube"></i>Youtube</a>
            <a href="https://facebook.com" target="_blank" class="quick-link"><i class="fab fa-facebook"></i>Facebook</a>
            <a href="https://twitter.com" target="_blank" class="quick-link"><i class="fab fa-twitter"></i>Twitter</a>
            <a href="https://bilibili.com" target="_blank" class="quick-link"><i class="fab fa-bilibili"></i>Bilibili</a>
            <a href="https://microsoft.com" target="_blank" class="quick-link"><i class="fab fa-microsoft"></i>Microsoft</a>
            <a href="https://music.163.com" target="_blank" class="quick-link"><i class="fas fa-music"></i>Music</a>
            <a href="https://minecraft.com" target="_blank" class="quick-link"><i class="fas fa-gamepad"></i>Minecraft</a>
        </div>
        <div class="footer">
            &copy; 2026 Qin_Xiaoyou Lightweight Search Engine
        </div>
    </div>
    <div class="settings-panel" id="settingsPanel">
        <div class="settings-header">
            <h2 class="settings-title"><i class="fas fa-sliders-h"></i> Settings</h2>
            <button class="close-settings" id="closeSettings"><i class="fas fa-times"></i></button>
        </div>
        <div class="setting-item">
            <div class="setting-title"><i class="fas fa-image"></i> Custom Background</div>
            <p style="font-size: 14px; color: var(--text-secondary); margin-bottom: 15px;">
                Upload a custom image or video to replace the default background.
            </p>
            <div class="bg-type-selector">
                <button class="bg-type-btn active" id="imgBgBtn">Image Background</button>
                <button class="bg-type-btn" id="videoBgBtn">Video Background</button>
            </div>
            <input type="file" id="bgUpload" accept="image/*">
            <input type="file" id="videoUpload" accept="video/mp4,video/webm,video/ogg">
            <button class="upload-btn" id="uploadImgBtn">Upload Image</button>
            <button class="upload-btn" id="uploadVideoBtn" style="display: none;">Select Video</button>
            <button class="upload-btn save-video-btn" id="saveVideoBtn" style="display: none;">ðŸ’¾ Save Video Background</button>
            <button class="upload-btn clear-cache-btn" id="clearCacheBtn">Clear Background Cache</button>
            <div class="tip-text">Tips: Video files are stored locally as original binary (support 4K resolution).</div>
            <div id="storageErrorTip" class="error-tip" style="display: none;"></div>
            <div id="storageSuccessTip" class="success-tip" style="display: none;"></div>
            <div style="margin-top: 15px; display: flex; align-items: center; gap: 15px;">
                <span style="font-size: 14px;">Use default background</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="defaultBgToggle">
                    <span class="toggle-slider"></span>
                </label>
            </div>
        </div>
        <div class="setting-item">
            <div class="setting-title"><i class="fas fa-lightbulb"></i> Search Suggestions</div>
            <p style="font-size: 14px; color: var(--text-secondary); margin-bottom: 15px;">
                Show relevant search suggestions as you type.
            </p>
            <div style="display: flex; align-items: center; gap: 15px;">
                <span style="font-size: 14px;">Enable suggestions</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="suggestionsToggle" checked>
                    <span class="toggle-slider"></span>
                </label>
            </div>
        </div>
    </div>
    <script>
        const el = {
            themeToggle: document.getElementById('themeToggle'),
            themeIcon: document.getElementById('themeIcon'),
            settingsBtn: document.getElementById('settingsBtn'),
            settingsPanel: document.getElementById('settingsPanel'),
            closeSettings: document.getElementById('closeSettings'),
            searchBox: document.getElementById('searchBox'),
            searchBtn: document.getElementById('searchBtn'),
            suggestionsBox: document.getElementById('suggestionsBox'),
            suggestionsContainer: document.getElementById('suggestionsContainer'),
            dynamicBg: document.getElementById('dynamicBg'),
            customBg: document.getElementById('customBg'),
            customVideoBg: document.getElementById('customVideoBg'),
            bgUpload: document.getElementById('bgUpload'),
            videoUpload: document.getElementById('videoUpload'),
            uploadImgBtn: document.getElementById('uploadImgBtn'),
            uploadVideoBtn: document.getElementById('uploadVideoBtn'),
            saveVideoBtn: document.getElementById('saveVideoBtn'),
            clearCacheBtn: document.getElementById('clearCacheBtn'),
            defaultBgToggle: document.getElementById('defaultBgToggle'),
            suggestionsToggle: document.getElementById('suggestionsToggle'),
            imgBgBtn: document.getElementById('imgBgBtn'),
            videoBgBtn: document.getElementById('videoBgBtn'),
            storageErrorTip: document.getElementById('storageErrorTip'),
            storageSuccessTip: document.getElementById('storageSuccessTip'),
            mainContainer: document.getElementById('mainContainer'),
            searchGroup: document.getElementById('searchGroup')
        };
        let tempVideoFile = null;
        let currentVideoUrl = null;
        const bgState = {
            activeType: 'default'
        };
        const sampleSuggestions = [
            "best programming tutorials 2026", "how to learn AI for beginners", "latest technology news 2026",
            "healthy vegan recipes for dinner", "top travel destinations for 2026", "best movies to watch 2026",
            "30 minute home workout routine", "small business ideas with low investment", "digital art tutorials for beginners",
            "chill lo-fi music playlist", "python projects for beginners", "web development roadmap 2026",
            "how to start a youtube channel", "personal finance tips for young adults", "best gaming laptops 2026",
            "easy weeknight dinners for family", "mental health self-care routines", "sustainable living tips",
            "crypto investing for beginners", "photography tips for smartphone", "remote work jobs 2026",
            "best books to read in 2026", "home organization ideas on a budget", "fitness meal prep ideas",
            "social media marketing strategies", "android vs ios 2026 comparison", "how to learn a new language fast",
            "DIY home decor ideas", "car maintenance tips for beginners", "best streaming services 2026",
            "gardening tips for small spaces", "online course platforms review", "cybersecurity best practices",
            "meditation for stress relief", "budget travel tips for students", "best productivity apps 2026",
            "cooking tips for beginners", "how to fix common computer issues", "pet care tips for new owners",
            "interior design trends 2026", "music production for beginners", "climate change facts and solutions",
            "parenting tips for first time parents", "best headphones under $100", "time management techniques"
        ];
        function openDB() {
            return new Promise((resolve, reject) => {
                if (!('indexedDB' in window)) {
                    reject(new Error('Browser does not support IndexedDB (use Chrome/Firefox/Edge)'));
                    return;
                }
                const request = indexedDB.open('ManualVideoBgDB', 1);
                request.onupgradeneeded = (e) => {
                    const db = e.target.result;
                    if (!db.objectStoreNames.contains('savedVideos')) {
                        db.createObjectStore('savedVideos', { keyPath: 'videoId' });
                    }
                };
                request.onsuccess = (e) => resolve(e.target.result);
                request.onerror = (e) => reject(new Error(`Failed to open DB: ${e.target.error.message}`));
            });
        }
        async function saveVideoToDB(videoId, file) {
            const db = await openDB();
            return new Promise((resolve, reject) => {
                const tx = db.transaction('savedVideos', 'readwrite');
                const store = tx.objectStore('savedVideos');
                const videoData = {
                    videoId: videoId,
                    file: file,
                    name: file.name,
                    size: file.size,
                    type: file.type,
                    saveTime: Date.now()
                };
                const request = store.put(videoData);
                request.onsuccess = () => resolve();
                request.onerror = (e) => reject(new Error(`Save failed: ${e.target.error.message}`));
            });
        }
        async function loadSavedVideo() {
            const savedVideoId = localStorage.getItem('savedVideoId');
            if (!savedVideoId) return null;
            try {
                const db = await openDB();
                return new Promise((resolve) => {
                    const tx = db.transaction('savedVideos', 'readonly');
                    const store = tx.objectStore('savedVideos');
                    const request = store.get(savedVideoId);
                    request.onsuccess = (e) => resolve(e.target.result || null);
                    request.onerror = () => resolve(null);
                });
            } catch (e) {
                el.storageErrorTip.textContent = `Load cache failed: ${e.message}`;
                el.storageErrorTip.style.display = 'block';
                return null;
            }
        }
        function previewVideoFile(file) {
            if (currentVideoUrl) URL.revokeObjectURL(currentVideoUrl);
            const url = URL.createObjectURL(file);
            currentVideoUrl = url;
            const video = el.customVideoBg;
            video.pause();
            video.src = '';
            video.src = url;
            video.muted = true;
            video.loop = true;
            video.playsInline = true;
            video.onloadeddata = () => {
                el.dynamicBg.style.opacity = 0;
                video.style.opacity = document.body.classList.contains('dark-theme') ? 0.5 : 1;
                video.play().catch(() => {});
                bgState.activeType = 'video';
            };
            video.onerror = () => {
                el.storageErrorTip.textContent = 'Video preview failed: Unsupported format or corrupted file';
                el.storageErrorTip.style.display = 'block';
                tempVideoFile = null;
                el.saveVideoBtn.style.display = 'none';
            };
        }
        el.uploadVideoBtn.onclick = () => el.videoUpload.click();
        el.videoUpload.onchange = (e) => {
            const file = e.target.files?.[0];
            if (!file) return;
            tempVideoFile = file;
            previewVideoFile(file);
            el.saveVideoBtn.style.display = 'inline-block';
            el.storageSuccessTip.textContent = 'Video previewed! Click "Save" to make it persistent (survives refresh)';
            el.storageSuccessTip.style.display = 'block';
            el.storageErrorTip.style.display = 'none';
        };
        el.saveVideoBtn.onclick = async () => {
            if (!tempVideoFile) {
                el.storageErrorTip.textContent = 'Please select a video first!';
                el.storageErrorTip.style.display = 'block';
                return;
            }
            try {
                const videoId = `vid-${Date.now()}-${btoa(tempVideoFile.name).slice(0, 8)}`;
                await saveVideoToDB(videoId, tempVideoFile);
                localStorage.setItem('savedVideoId', videoId);
                localStorage.setItem('savedVideoName', tempVideoFile.name);
                el.storageSuccessTip.textContent = `âœ… Video saved successfully (ID: ${videoId})! Refresh to verify.`;
                el.storageSuccessTip.style.display = 'block';
                el.storageErrorTip.style.display = 'none';
                el.saveVideoBtn.style.display = 'none';
                el.defaultBgToggle.checked = false;
            } catch (e) {
                el.storageErrorTip.textContent = `Save failed: ${e.message}`;
                el.storageErrorTip.style.display = 'block';
            }
        };
        el.clearCacheBtn.onclick = async () => {
            try {
                if (currentVideoUrl) {
                    URL.revokeObjectURL(currentVideoUrl);
                    currentVideoUrl = null;
                }
                tempVideoFile = null;
                const db = await openDB();
                const tx = db.transaction('savedVideos', 'readwrite');
                await tx.objectStore('savedVideos').clear();
                localStorage.removeItem('savedVideoId');
                localStorage.removeItem('savedVideoName');
                el.customVideoBg.pause();
                el.customVideoBg.src = '';
                el.customVideoBg.style.opacity = 0;
                el.dynamicBg.style.opacity = document.body.classList.contains('dark-theme') ? 0.5 : 1;
                el.defaultBgToggle.checked = true;
                bgState.activeType = 'default';
                el.saveVideoBtn.style.display = 'none';
                el.storageSuccessTip.textContent = 'âœ… All cache cleared! Restored default background.';
                el.storageSuccessTip.style.display = 'block';
                el.storageErrorTip.style.display = 'none';
            } catch (e) {
                el.storageErrorTip.textContent = `Clear cache failed: ${e.message}`;
                el.storageErrorTip.style.display = 'block';
            }
        };
        const storageUtil = {
            setLocal: (key, value) => {
                try {
                    localStorage.setItem(key, JSON.stringify(value));
                    return true;
                } catch (e) {
                    el.storageErrorTip.textContent = `Local storage failed: ${e.message}`;
                    el.storageErrorTip.style.display = 'block';
                    return false;
                }
            },
            getLocal: (key) => {
                try {
                    const val = localStorage.getItem(key);
                    return val ? JSON.parse(val) : {};
                } catch (e) {
                    return {};
                }
            }
        };
        function loadBaseSettings() {
            try {
                const baseSettings = storageUtil.getLocal('searchEngineBase');
                const imgBgData = storageUtil.getLocal('searchEngineImgBg');
                const isDark = baseSettings.theme === 'dark';
                const opacity = isDark ? 0.5 : 1;
                const bgType = baseSettings.bgType || 'image';
                const useDefault = baseSettings.useDefaultBg ?? false;
                if (isDark) {
                    document.body.classList.add('dark-theme');
                    el.themeIcon.className = 'fas fa-sun';
                } else {
                    document.body.classList.remove('dark-theme');
                    el.themeIcon.className = 'fas fa-moon';
                }
                el.suggestionsToggle.checked = baseSettings.suggestionsEnabled ?? true;
                el.defaultBgToggle.checked = useDefault;
                if (bgType === 'video') {
                    el.imgBgBtn.classList.remove('active');
                    el.videoBgBtn.classList.add('active');
                    el.uploadImgBtn.style.display = 'none';
                    el.uploadVideoBtn.style.display = 'inline-block';
                } else {
                    el.imgBgBtn.classList.add('active');
                    el.videoBgBtn.classList.remove('active');
                    el.uploadImgBtn.style.display = 'inline-block';
                    el.uploadVideoBtn.style.display = 'none';
                }
                el.customBg.classList.remove('active');
                el.dynamicBg.style.opacity = opacity;
                if (!useDefault && bgType === 'image' && imgBgData.src) {
                    el.customBg.src = imgBgData.src;
                    el.customBg.classList.add('active');
                    el.customBg.style.opacity = opacity;
                    el.dynamicBg.style.opacity = 0;
                    bgState.activeType = 'image';
                }
            } catch (e) {
                console.error('Load base settings failed:', e);
            }
        }
        function saveSettings(customData = {}) {
            const baseSettings = {
                theme: document.body.classList.contains('dark-theme') ? 'dark' : 'light',
                bgType: el.imgBgBtn.classList.contains('active') ? 'image' : 'video',
                suggestionsEnabled: el.suggestionsToggle.checked,
                useDefaultBg: el.defaultBgToggle.checked,
                currentVideoId: customData.currentVideoId || storageUtil.getLocal('searchEngineBase').currentVideoId || null
            };
            storageUtil.setLocal('searchEngineBase', baseSettings);
        }
        function toggleTheme() {
            document.body.classList.toggle('dark-theme');
            const isDark = document.body.classList.contains('dark-theme');
            el.themeIcon.className = isDark ? 'fas fa-sun' : 'fas fa-moon';
            const opacity = isDark ? 0.5 : 1;
            if (bgState.activeType === 'default') {
                el.dynamicBg.style.opacity = opacity;
            } else if (bgState.activeType === 'image') {
                el.customBg.style.opacity = opacity;
                el.dynamicBg.style.opacity = 0;
            } else if (bgState.activeType === 'video') {
                el.customVideoBg.style.opacity = opacity;
                el.dynamicBg.style.opacity = 0;
            }
            saveSettings();
        }
        function showSuggestions(query) {
            const trimQuery = query.trim();
            if (!trimQuery || !el.suggestionsToggle.checked) {
                el.suggestionsContainer.classList.remove('active');
                el.suggestionsBox.innerHTML = '';
                return;
            }
            const filtered = sampleSuggestions.filter(s => s.toLowerCase().includes(trimQuery.toLowerCase()));
            if (filtered.length === 0) {
                el.suggestionsContainer.classList.remove('active');
                el.suggestionsBox.innerHTML = '';
                return;
            }
            el.suggestionsBox.innerHTML = filtered.map(s => `<div class="suggestion-item">${s}</div>`).join('');
            el.suggestionsBox.onclick = (e) => {
                const target = e.target.closest('.suggestion-item');
                if (target) {
                    el.searchBox.value = target.textContent;
                    performSearch();
                    el.suggestionsContainer.classList.remove('active');
                }
            };
            el.suggestionsContainer.classList.add('active');
        }
        function performSearch() {
            const query = el.searchBox.value.trim();
            if (query) {
                window.open(`https://www.bing.com/search?q=${encodeURIComponent(query)}`, '_self');
            }
        }
        function handleImageUpload(e) {
            const file = e.target.files[0];
            if (!file) return;
            el.storageSuccessTip.style.display = 'none';
            if (file.size > 5 * 1024 * 1024) {
                el.storageErrorTip.textContent = 'Image too large! Please upload less than 5MB.';
                el.storageErrorTip.style.display = 'block';
                return;
            }
            const reader = new FileReader();
            reader.onload = (e) => {
                el.customVideoBg.classList.remove('active');
                const opacity = document.body.classList.contains('dark-theme') ? 0.5 : 1;
                if (el.customBg.classList.contains('active')) el.customBg.style.opacity = 0;
                else el.dynamicBg.style.opacity = 0;
                setTimeout(() => {
                    el.customBg.src = e.target.result;
                    el.customBg.classList.add('active');
                    el.customBg.style.opacity = 0;
                    setTimeout(() => el.customBg.style.opacity = opacity, 50);
                }, 300);
                bgState.activeType = 'image';
                currentVideoUrl = null;
                tempVideoFile = null;
                el.defaultBgToggle.checked = false;
                storageUtil.setLocal('searchEngineImgBg', { src: e.target.result });
                saveSettings();
                el.storageSuccessTip.textContent = 'Image background saved successfully';
                el.storageSuccessTip.style.display = 'block';
                el.storageErrorTip.style.display = 'none';
            };
            reader.readAsDataURL(file);
        }
        el.defaultBgToggle.onchange = () => {
            const useDefault = el.defaultBgToggle.checked;
            const opacity = document.body.classList.contains('dark-theme') ? 0.5 : 1;

            if (useDefault) {
                el.customBg.classList.remove('active');
                el.customVideoBg.style.opacity = 0;
                el.dynamicBg.style.opacity = opacity;
                bgState.activeType = 'default';
            } else {
                const bgType = el.imgBgBtn.classList.contains('active') ? 'image' : 'video';
                if (bgType === 'image') {
                    const imgData = storageUtil.getLocal('searchEngineImgBg');
                    if (imgData.src) {
                        el.customBg.src = imgData.src;
                        el.customBg.classList.add('active');
                        el.customBg.style.opacity = opacity;
                        el.dynamicBg.style.opacity = 0;
                        bgState.activeType = 'image';
                    } else {
                        el.storageErrorTip.textContent = 'No image background found! Please upload an image first.';
                        el.storageErrorTip.style.display = 'block';
                        el.defaultBgToggle.checked = true;
                    }
                } else {
                    if (currentVideoUrl) {
                        el.dynamicBg.style.opacity = 0;
                        el.customVideoBg.style.opacity = opacity;
                        el.customVideoBg.play().catch(() => {});
                        bgState.activeType = 'video';
                    } else {
                        el.storageErrorTip.textContent = 'No video background found! Please select and save a video first.';
                        el.storageErrorTip.style.display = 'block';
                        el.defaultBgToggle.checked = true;
                    }
                }
            }
            saveSettings();
        };
        function switchBgType(type) {
            const opacity = document.body.classList.contains('dark-theme') ? 0.5 : 1;
            const useDefault = el.defaultBgToggle.checked;
            if (type === 'image') {
                el.imgBgBtn.classList.add('active');
                el.videoBgBtn.classList.remove('active');
                el.uploadImgBtn.style.display = 'inline-block';
                el.uploadVideoBtn.style.display = 'none';
                el.saveVideoBtn.style.display = 'none';
                if (!useDefault) {
                    const imgData = storageUtil.getLocal('searchEngineImgBg');
                    if (imgData.src) {
                        el.customBg.src = imgData.src;
                        el.customBg.classList.add('active');
                        el.customBg.style.opacity = opacity;
                        el.customVideoBg.style.opacity = 0;
                        el.dynamicBg.style.opacity = 0;
                        bgState.activeType = 'image';
                    } else {
                        el.storageErrorTip.textContent = 'No image background found! Please upload an image first.';
                        el.storageErrorTip.style.display = 'block';
                    }
                }
            } else {
                el.videoBgBtn.classList.add('active');
                el.imgBgBtn.classList.remove('active');
                el.uploadImgBtn.style.display = 'none';
                el.uploadVideoBtn.style.display = 'inline-block';
                
                if (!useDefault) {
                    if (currentVideoUrl) {
                        el.customVideoBg.style.opacity = opacity;
                        el.dynamicBg.style.opacity = 0;
                        bgState.activeType = 'video';
                    } else {
                        el.storageErrorTip.textContent = 'No video background found! Please select and save a video first.';
                        el.storageErrorTip.style.display = 'block';
                    }
                }
            }
            saveSettings();
        }
        async function init() {
            el.themeToggle.onclick = toggleTheme;
            el.settingsBtn.onclick = () => el.settingsPanel.classList.add('active');
            el.closeSettings.onclick = () => el.settingsPanel.classList.remove('active');
            el.searchBtn.onclick = performSearch;
            el.searchBox.oninput = (e) => showSuggestions(e.target.value);
            el.searchBox.onkeydown = (e) => {
                if (e.key === 'Enter') {
                    performSearch();
                    el.suggestionsContainer.classList.remove('active');
                }
            };
            el.imgBgBtn.onclick = () => switchBgType('image');
            el.videoBgBtn.onclick = () => switchBgType('video');
            el.uploadImgBtn.onclick = () => el.bgUpload.click();
            el.bgUpload.onchange = handleImageUpload;
            document.onclick = (e) => {
                if (!el.searchGroup.contains(e.target) && !el.suggestionsContainer.contains(e.target)) {
                    el.suggestionsContainer.classList.remove('active');
                }
            };
            el.settingsPanel.onclick = (e) => e.stopPropagation();
            el.suggestionsContainer.onclick = (e) => e.stopPropagation();
            loadBaseSettings();
            const savedVideo = await loadSavedVideo();
            if (savedVideo && savedVideo.file) {
                const url = URL.createObjectURL(savedVideo.file);
                currentVideoUrl = url;
                
                const video = el.customVideoBg;
                video.src = url;
                video.muted = true;
                video.loop = true;
                video.playsInline = true;
                
                video.onloadeddata = () => {
                    el.dynamicBg.style.opacity = 0;
                    video.style.opacity = document.body.classList.contains('dark-theme') ? 0.5 : 1;
                    video.play().catch(() => {});
                    el.defaultBgToggle.checked = false;
                    bgState.activeType = 'video';
                    el.storageSuccessTip.textContent = `âœ… Restored saved video: ${savedVideo.name}`;
                    el.storageSuccessTip.style.display = 'block';
                };
            }
            el.mainContainer.style.opacity = '1';
        }
        document.addEventListener('DOMContentLoaded', init);
        window.addEventListener('beforeunload', () => {
            if (currentVideoUrl) {
                URL.revokeObjectURL(currentVideoUrl);
            }
        });
    </script>
</body>
</html>